[workspace]
name = "scipystack"
channels = ["https://prefix.dev/conda-forge"]
platforms = ["osx-arm64", "linux-64", "win-64"]


[dependencies]
gh = ">=2.79.0,<3"


[tasks.clean]
args = ["repo"]
cmd = "rm -rf {{ repo }}/{{ repo }}"
description = "Clean the {repo}/{repo} directory."

[tasks._repo_clone]
args = ["org", "repo"]
cmd = "gh repo clone {{ org }}/{{ repo }} {{ repo }}/{{ repo }}"

[tasks._repo_set_default]
args = ["repo"]
cmd = "cd {{ repo }}/{{ repo }}; gh repo set-default"

[tasks._repo_fork_remote]
args = ["repo"]
cmd = "cd {{ repo }}/{{ repo }}; gh repo fork --remote"

[tasks.submodules]
args = ["repo"]
cmd = "cd {{ repo }}/{{ repo }}; git submodule update --init"

[tasks.clone]
args = ["org", "repo"]
depends-on = [
  { task = "clean", args = ["{{ repo }}"] },
  { task = "_repo_clone", args = ["{{ org }}", "{{ repo }}"] },
  { task = "_repo_set_default", args = ["{{ repo }}"] },
  { task = "_repo_fork_remote", args = ["{{ repo }}"] },
  { task = "submodules", args = ["{{ repo }}"] },
]
description = "Clone a given {org}/{repo} source from GitHub into the {repo}/{repo} directory of the workspace. Set the upstream repo as default, and set a fork as origin. Update the repo's submodules."

[tasks.clone-all]
depends-on = ["clone-meson", "clone-numpy", "clone-openblas", "clone-pywt", "clone-scipy"]

[tasks.clone-meson]
depends-on = [{ task = "clone", args = ["mesonbuild", "meson"] }]
description = "Clone the mesonbuild/meson source into the workspace."

[tasks.clone-numpy]
depends-on = [{ task = "clone", args = ["numpy", "numpy"] }]
description = "Clone the numpy/numpy source into the workspace."

[tasks.clone-openblas]
depends-on = [{ task = "clone", args = ["OpenMathLib", "OpenBLAS"] }]
description = "Clone the OpenMathLib/OpenBLAS source into the workspace."

[tasks.clone-pywt]
depends-on = [{ task = "clone", args = ["PyWavelets", "pywt"] }]
description = "Clone the PyWavelets/pywt source into the workspace."

[tasks.clone-scipy]
depends-on = [{ task = "clone", args = ["scipy", "scipy"] }]
description = "Clone the scipy/scipy source into the workspace."
